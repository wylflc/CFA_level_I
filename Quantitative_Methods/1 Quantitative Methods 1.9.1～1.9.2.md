# 1 Quantitative Methods 量化方法
## 1.9 Parametric and Non-Parametric Tests of Independence 参数检验与非参数检验的独立性检验

#### 学习要点

- 解释关于总体相关系数为零的假设的参数检验和非参数检验，并确定在给定显著性水平下是否拒绝该假设。  
- 解释基于列联表数据的独立性检验。

### 1.9.1 Tests Concerning Correlation 相关性检验

#### 参数检验中的相关性检验

参数化的相关系数检验通常被称为皮尔逊相关系数、双变量相关系数或简单地称为相关性。我们的重点是检验相关性，而非实际计算这一统计量，但理解样本相关性的公式有助于区分参数检验和非参数检验。

##### 1. 样本相关系数公式

考虑两个变量 X 和 Y，样本相关系数 $r_{XY}$ 公式如下：

$$
r_{XY} = \frac{s_{XY}}{s_X s_Y}
$$

其中，$s_{XY}$ 是 X 和 Y 变量的样本协方差，$s_X$ 和 $s_Y$ 分别是 X 和 Y 变量的标准差。我们通常省略下标，表示为 $r$。

该公式表明，每个观测值都与其各自变量的均值进行比较，并且由于协方差的存在，每个观测值与各自均值的差异对于相关性的计算至关重要。协方差决定了相关性的符号。

##### 2. 相关性检验的t统计量

如果两个变量服从正态分布，我们可以使用样本相关系数 $r$ 来检验零假设（$H_0: \rho = 0$）是否应该被拒绝。t检验的公式如下：

$$
t = \frac{r \sqrt{n - 2}}{\sqrt{1 - r^2}}
$$

该检验统计量服从自由度为 $n - 2$ 的 t 分布。

##### 3. 样本大小对检验结果的影响

观察公式，可以发现，当样本大小 $n$ 增加时，拒绝零假设所需的 $r$ 的绝对值会减小，原因有两个：
1. 随着 $n$ 的增加，自由度增大，t 统计量的临界值的绝对值减小。
2. 分子部分随着 $n$ 的增大而增大，从而导致计算出的 t 统计量的绝对值增大。

例如，在样本大小 $n = 12$ 时，$r = 0.35$ 得到的 t 统计量为 1.182，这在 0.05 显著性水平下与零无显著差异（$t_{\alpha/2} = \pm 2.228$）。但当样本大小为 $n = 32$ 时，相同的样本相关系数 $r = 0.35$ 结果为 t 统计量 2.046，恰好在 0.05 水平下显著（$t_{\alpha/2} = \pm 2.042$）。

##### 4. 样本大小与假设检验的关系

当从同一总体抽样时，随着样本量的增加，拒绝错误零假设的可能性（即，检验的效能）也随之增加。更大的样本量增加了 t 统计量分子的大小，使得检验结果更容易达到显著性。

##### 5. 总结

- **样本相关系数**：计算样本中两个变量的线性关系强度。
- **t 统计量**：用来检验零假设是否应当被拒绝，检验统计量的大小随着样本量的增加而增加。
- **样本量的影响**：较大的样本量更容易使检验达到显著性水平，进而拒绝零假设。

#### 非参数相关性检验：斯皮尔曼等级相关系数

当我们认为所考虑的总体显著偏离正态分布时，可以使用基于斯皮尔曼等级相关系数 $r_S$ 的检验。斯皮尔曼等级相关系数本质上等同于皮尔逊相关系数，但它是基于两个变量（例如 X 和 Y）在各自样本中的排名来计算的。计算 $r_S$ 需要以下步骤：

##### 1. 排名观察值
- 对 X 的观察值从大到小进行排名。给最大值分配排名 1，第二大值分配排名 2，依此类推。如果有并列的值，则给每个并列的观察值分配它们共同占据的排名的平均值。例如，如果第三大和第四大的值并列，则给这两个观察值分配 3.5 的排名（即 3 和 4 的平均值）。对 Y 的观察值也进行相同的操作。

##### 2. 计算排名差异
- 计算每一对 X 和 Y 的观察值之间的排名差异 $d_i$，然后计算 $d_i^2$（排名差异的平方）。

##### 3. 斯皮尔曼等级相关系数公式
- 设样本大小为 $n$，斯皮尔曼等级相关系数 $r_S$ 公式如下：

$$
r_S = 1 - \frac{6 \sum_{i=1}^{n} d_i^2}{n(n^2 - 1)}.
$$

##### 示例计算
假设一位分析师正在考察两个投资基金 A 和 B 在 35 年间的收益关系。她担心参数相关性检验的假设不成立，因此决定使用斯皮尔曼等级相关系数进行检验。她的假设为 $H_0: r_S = 0$ 和 $H_a: r_S ≠ 0$。她收集了收益数据，对每个基金的收益进行排名，并计算排名差异和平方差异。
![[Pasted image 20250326184032.png]]

**计算步骤**：
- 假设样本大小为 35，所计算的斯皮尔曼等级相关系数为：

$$
r_S = 1 - \frac{6(2202)}{35(35^2 - 1)} = 0.6916.
$$

##### t 检验
对于样本量较大的检验（$n > 30$），我们可以使用 t 检验，公式如下：

$$
t = \frac{r_S \sqrt{n - 2}}{\sqrt{1 - r_S^2}}.
$$

在此例中，计算得到的 t 值为：

$$
t = \frac{0.6916 \times \sqrt{33}}{\sqrt{1 - (0.6916)^2}} = 5.5005.
$$

##### 结论
根据计算出的 t 值和临界值（对于自由度 $33$，临界值为 $\pm 2.0345$），我们拒绝原假设 $H_0: r_S = 0$，得出结论：基金 A 和基金 B 之间的收益相关性显著不同于零。

### 1.9.2 Tests of Independence Using Contingency Table Data 使用列联表数据进行独立性检验

#### 使用列联表数据进行独立性检验

当我们希望检验两个分类变量是否独立时，可以使用列联表和卡方检验。列联表（也称为交叉表）显示了两个分类变量的频数分布，卡方检验则用于检验变量之间是否存在显著的依赖关系。具体步骤如下：

##### 1. 构建列联表
- 列联表是一个矩阵，其中每个单元格包含两个变量的组合频数。例如，假设我们有一个关于性别和是否购买某种产品的研究，我们的列联表可能如下所示：

| 性别 \ 产品购买 | 是   | 否   | 合计 |
| --------------- | ---- | ---- | ---- |
| 男性            | 30   | 20   | 50   |
| 女性            | 40   | 10   | 50   |
| 合计            | 70   | 30   | 100  |

##### 2. 假设检验
- 假设检验的原假设（$H_0$）是两个变量独立，即产品购买与性别之间没有关系。备择假设（$H_a$）是两个变量不独立，即存在依赖关系。

##### 3. 计算期望频数
- 对于列联表中的每个单元格，计算其期望频数（$E_{ij}$），其计算公式为：

$$
E_{ij} = \frac{(行合计_i) \times (列合计_j)}{总合计}.
$$

在上述表格中，期望频数可以通过以下方式计算。例如，性别为男性且购买的期望频数为：

$$
E_{男性, 是} = \frac{50 \times 70}{100} = 35.
$$

##### 4. 计算卡方统计量
- 卡方统计量的计算公式为：

$$
\chi^2 = \sum_{i=1}^{r} \sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}},
$$

其中 $O_{ij}$ 是实际观察到的频数，$E_{ij}$ 是期望频数，$r$ 和 $c$ 分别是列联表的行数和列数。

- 标准化残差，也称为Pearson残差，用于衡量观察频数与期望频数之间的差异，并对差异进行标准化。标准化残差的计算公式如下：

$$
\text{Standardized residual} = \frac{O_{ij} - E_{ij}}{\sqrt{E_{ij}}}
$$

  其中，$O_{ij}$ 是实际观察到的频数，$E_{ij}$ 是期望频数，$E_{ij}$ 的平方根用于标准化该差异。

##### 5. 判断统计显著性
- 根据计算出的卡方统计量 $\chi^2$ 和自由度（$df = (r - 1)(c - 1)$）查找卡方分布表的临界值。根据显著性水平（通常为 0.05）来决定是否拒绝原假设。

##### 6. 结论
- 如果计算出的 $\chi^2$ 值大于临界值，我们拒绝原假设，表明两个变量之间存在显著的关联关系。如果计算出的 $\chi^2$ 值小于临界值，则不能拒绝原假设，表明两个变量是独立的。

### 示例
假设我们使用以上的列联表数据进行卡方检验：

| 性别 \ 产品购买 | 是   | 否   | 合计 |
| --------------- | ---- | ---- | ---- |
| 男性            | 30   | 20   | 50   |
| 女性            | 40   | 10   | 50   |
| 合计            | 70   | 30   | 100  |

- 期望频数的计算（例如，男性且购买）为 $E_{男性, 是} = \frac{50 \times 70}{100} = 35$。

- 计算卡方统计量，假设 $\chi^2 = 6.0$。

- 查找自由度为 $df = (2 - 1)(2 - 1) = 1$ 的卡方分布临界值，在显著性水平 0.05 下，临界值为 3.841。

- 因为 $\chi^2 = 6.0 > 3.841$，我们拒绝原假设，得出结论：性别与产品购买之间存在显著的依赖关系。

