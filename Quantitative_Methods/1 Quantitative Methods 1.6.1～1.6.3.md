# 1 Quantitative Methods 量化方法
## 1.6 Simulation Methods 仿真方法

#### 学习要点：

- 解释正态分布和对数正态分布之间的关系，以及为什么在使用连续复利资产回报时使用对数正态分布来建模资产价格  
- 描述蒙特卡洛模拟，并解释它如何在投资应用中使用  
- 描述在投资应用中如何使用自助法重采样进行基于观察数据的模拟

### 1.6.1 Lognormal Distribution and Continuous Compounding 对数正态分布和连续复利

对数正态分布是一种常用于描述资产价格的分布，尤其是在考虑资产回报时。它的特点是，当资产价格的对数（即连续复利的回报）服从正态分布时，资产价格本身遵循对数正态分布。

#### 正态分布与对数正态分布的关系

- 如果一个资产的**回报率**服从正态分布，那么该**资产的价格**在经过一定时间后，可能呈现出对数正态分布。
- 资产的回报率通过连续复利计算，即资产价格变化通过连续的时间进行累积，导致**资产价格**的分布为对数正态。

#### 为什么使用对数正态分布

在实际金融模型中，资产价格通常呈现**偏态分布**且具有**正的偏度**，这意味着资产价格的下跌通常受到限制，而上升则可能没有明确的上限。对数正态分布能够更好地描述这一特性，特别是在长时间段内，资产价格增长呈现出稳定的几何增长趋势。

#### 对数正态分布的均值和方差

对数正态分布的均值和方差的表达式总结如下，其中 $\mu$ 和 $\sigma^2$ 是相关正态分布的均值和方差：

- **对数正态随机变量的均值 ($\mu_L$)**：
  $$
   \mu_L = \exp(\mu + 0.50\sigma^2)
   $$
   
-  **对数正态随机变量的方差 ($\sigma_L^2)**：
   $$
   \sigma_L^2 = \exp(2\mu + \sigma^2) \times [\exp(\sigma^2) − 1]
   $$
   
这些公式用于描述对数正态分布的中心趋势（均值）和波动性（方差）。

#### 股票收益率与股票价格的关系

在这一部分，我们展示如果股票的连续复利收益率是正态分布的，那么未来的股票价格**必然是对数正态分布**的。此外，即使连续复利收益率不符合正态分布，股票价格也可以**很好地用对数正态分布来描述**。这些结果为使用对数正态分布来建模资产价格提供了理论基础。

##### 股票价格的数学表达式

股票价格在未来时间$T$的表达式为：
$$
P_T = P_0 \exp(r_{0,T})
$$
其中，$P_0$ 是当前股票价格，$r_{0,T}$ 是从时间0到T的连续复利收益率。

我们在之前的课程中展示了$r_{0,T}$（从$0$到$T$的连续复利收益率）是各个阶段收益率之和，如下所示：
$$
r_{0,T} = r_{T-1,T} + r_{T-2,T-1} + \dots + r_{0,1}
$$
如果这些较短期的收益率是正态分布的，那么$r_{0,T}$也是正态分布的（在一定假设下）。由于$P_T$与正态随机变量的对数成正比，$P_T$是对数正态分布的。

##### 连续复利收益率的独立同分布假设

许多投资应用的一个关键假设是收益率是独立同分布（$i.i.d.$）。
- 独立性表示投资者不能通过过去的收益率预测未来的收益率；
- 同分布性表示收益率的均值和方差在各个时期保持不变。

假设单期连续复利收益率（如$r_{0,1}$）是独立同分布的随机变量，均值为$\mu$，方差为$\sigma^2$（不做正态或其他分布假设）。那么，

- 期望收益：$E(r_{0,T}) = \mu T$
- 方差：$\sigma^2(r_{0,T}) = \sigma^2 T$

连续复利收益率的T期持有期的方差是$T$乘以单期收益率的方差；$\sigma(r_{0,T}) = \sigma \sqrt{T}$。如果单期连续复利收益率是正态分布的，那么T期的连续复利收益率$r_{0,T}$也将是正态分布的，均值为$\mu T$，方差为$\sigma^2 T$。

##### 对数正态分布的应用

即使单期连续复利收益率不是正态分布，它们的和$r_{0,T}$也会根据**中心极限定理**近似为正态分布。现在比较$P_T = P_0 \exp(r_{0,T})$与$Y = \exp(X)$，其中$X$是正态分布，$Y$是对数正态分布（如前所述）。显然，我们可以将未来的股票价格$P_T$建模为对数正态随机变量，因为$r_{0,T}$应至少近似为正态分布。正态分布收益率的这一假设理论上为使用对数正态分布作为股票价格分布模型提供了基础。

##### 连续复利收益率与波动率

连续复利收益率在许多资产定价模型和风险管理中扮演着重要角色。**波动率**衡量了标的资产连续复利收益率的标准差；按惯例，它被表示为年化指标。在实践中，我们通常使用历史连续复利日收益率序列来估计波动率。我们收集一组日持有期收益率，将其转换为连续复利日收益率，然后计算连续复利日收益率的标准差，并使用公式年化该数值。

年化通常是基于$250$个交易日来进行的，这是金融市场通常开放交易的工作日数。因此，如果日波动率为$0.01$，那么我们会将波动率（按年化）表示为$0.01 \times \sqrt{250} = 0.1581$。

下例展示如何估计股票的波动率。

##### 例题

![[Pasted image 20250324170906.png]]

1. 估算Astra股票的波动率（按每年250个交易日年化波动率）

##### 解答

1. 首先计算这周每天的连续复利收益率，然后计算这周连续复利收益率的标准差作为波动率参考值，最后计算年化波动率。
   - 每天的复利收益率：$\ln\left(\frac{7000}{6950}\right) = 0.007168$，类似计算得到$−0.021661, −0.037179, −0.038615$；
   - 上述数据的标准差计算得到为$\sigma = 0.021261$；
   - 年化波动率为$\sigma\times \sqrt{250} = 0.336165$。

### 1.6.2 Monte Carlo Simulation 蒙特卡洛模拟

蒙特卡罗模拟是一种通过随机抽样来解决数学问题的方法，广泛应用于金融领域，尤其在**期权定价、风险分析和投资组合优化**等方面。该方法通过多次随机模拟结果，估计金融产品或投资组合的风险和回报。

#### 蒙特卡罗模拟用于估值有条件债务的六步过程

以下是实施蒙特卡罗模拟以估值有条件债务的六步过程的详细说明：

##### 步骤 1：确定关注的量并定义相关变量
首先，指定要计算的关注量，这里是有条件债务的价值。相关的基础变量是股票价格。然后，指定基础变量的起始值。

我们用 $C_{i,T}$ 表示债务在到期时的价值，$T$ 表示到期时间。下标 $i$ 表示第 $i$ 次模拟实验的结果，每次模拟实验都涉及随机抽样（即步骤 4 的一次迭代）。

##### 步骤 2：指定时间网格
选择一个时间范围，并将其分成若干子时期——例如，设定总共有 $K$ 个子时期。日历时间除以子时期数 $K$，得到每个子时期的时间增量 $\Delta t$。例如，日历时间为一年，$K$ 为 12，则 $\Delta t$ 为一个月。

##### 步骤 3：指定生成数据的方法
此步骤要求对驱动基础变量的关键风险因素做出分布假设。例如，股票价格是有条件债务的基础变量，因此需要一个模型来描述股票价格的变动，实际上是周期性回报。我们选择以下股票价格变化的模型，其中 $Z_k$ 表示标准正态随机变量：
$$
\begin{align*}
\Delta_\text{股票价格} = (\mu \times \text{先前股票价格} \times \Delta t) \\
+ (\sigma \times \text{先前股票价格} \times Z_k)
\end{align*}
$$
其中 $Z_k$ 是模拟中的关键风险因素。通过选择 $\mu$（均值）和 $\sigma$（标准差），我们控制股票价格变量的分布。虽然这个例子只有一个关键风险因素，但在实际模拟中，可能会有多个关键风险因素。

##### 步骤 4：绘制随机值
接下来，使用计算机程序或电子表格函数，绘制每个风险因素的 $K$ 个随机值。在本示例中，电子表格函数将生成 $K$ （$= 12$）个标准正态变量的值：$Z_1$, $Z_2$, $Z_3$, ..., $Z_K$。我们将在描述模拟步骤的顺序后，讨论如何生成标准正态随机数（或任何其他分布的随机数）。

##### 步骤 5：使用模拟值生成股票价格并估算有条件债务的价值
这一阶段将使用股票价格动态模型（第 3 步中定义的模型）将步骤 3 中生成的标准正态随机数转化为股票价格变化（$\Delta$股票价格）。结果将是 $K$ 个关于股票价格变化的观察值（记住，$K = 12$）。然后，进行额外的计算，将这些变化转化为 $K$ 个股票价格序列，以初始股票价格为起始值，涵盖 $K$ 个子时期。这一步非常重要：我们依赖蒙特卡罗模拟的分布假设，随机创建一个非常大的股票价格过程。

##### 步骤 6：计算平均股票价格及有条件债务的现值
该步骤计算有条件债务的平均股票价格（将 $K$ 个股票价格求和并除以 $K$）。然后，计算债务在到期时的价值 $C_{i,T}$，并通过使用适当的贴现率将该终值折现为现值 $C_i^0$。在此，$C_i^0$ 的下标 $i$ 与 $C_{i,T}$ 中的下标相同，表示第 $i$ 次模拟实验的结果。此时，我们完成了一个模拟实验。

##### 重复步骤 4 和 5
重复步骤 4 和 5，直到完成所需数量的实验。反复执行步骤 4，直到完成指定的实验次数 $I$。最后，生成模拟的汇总值和统计数据。在本示例中，我们的关注量是所有模拟实验（$I = 1,000$）的 $C_i^0$ 的均值。这个均值就是我们有条件债务的蒙特卡罗估算值。

### 1.6.3 Bootstrapping 引导法

#### 什么是引导法？
引导法是一种统计方法，广泛应用于金融和经济学中，用于从样本数据中估计样本分布的特征或构建估计模型。该方法通过对原始数据集进行多次有放回的随机抽样，从而生成多个新的样本集，进而分析这些新样本集的统计特性。

在金融领域，引导法常用于估计收益率的分布、构建利率曲线、风险管理和期权定价等。

#### 引导法的基本步骤
1. **从原始数据中随机抽样**：从给定的数据集（如历史收益率）中进行有放回的抽样，生成一个新的样本集。每个样本集的大小与原始数据集相同。
2. **计算所需的统计量**：对新生成的样本集计算所需的统计量（例如，均值、方差等），并记录结果。
3. **重复抽样和计算**：重复步骤 1 和 2 多次（通常数千次或更多），每次都从原始数据中抽取不同的样本集。
4. **分析结果**：通过对所有抽样计算的统计量进行分析，得出数据的分布特征，并根据这些特征进行进一步的决策或推断。

#### 在金融中的应用
1. **利率曲线构建**：通过对历史利率数据进行引导抽样，构建利率曲线，用于估计未来的利率走势。
2. **期权定价**：利用引导法生成多个可能的价格路径，通过计算每条路径的期权收益，进而估算期权的价值。
3. **风险管理**：通过模拟不同的市场情境（如股票价格或利率的变化）来评估投资组合的风险。

#### 优点与局限
**优点**：
- 不依赖于复杂的分布假设，适用于不完全或非正态分布的数据。
- 可以处理小样本数据，提供更为稳健的估计。
- 可用于构建非参数模型。

**局限**：
- 计算量大，尤其是在需要多次重复抽样时。
- 对于某些类型的数据（如时间序列数据），可能需要进行额外的处理，以避免自相关性带来的影响。

